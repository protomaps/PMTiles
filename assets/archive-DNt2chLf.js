import{r as mt,c as x,d as St,p as yt,b as A,t as Ct,e as V,a as wt,S as M,E as Lt,F as Tt,f as Dt,P as It,m as Z,h as C,i as e,v as P,_ as Mt,j as G,w as I,s as kt,q as zt,x as Et,J as E,o as Ot,u as Ut}from"./Frame-BtpbgdIa.js";import{S as Ft,m as j,R as Pt,C as jt}from"./index-C1v7Kok2.js";var At=C('<div class="flex-1 flex flex-col"><div class="h-full flex-1">'),Rt=C('<button class="mx-2 underline cursor-pointer"type=button>close'),Ht=C('<div class="flex-1 overflow-hidden"><div class="app-well md:px-4 md:py-2 flex"><span class=flex-1>entries <!>-<!> of </span><button class="mx-2 cursor-pointer"type=button>prev</button><button class="mx-2 cursor-pointer"type=button>next</button></div><div class="h-full overflow-y-scroll"><table class="h-full text-right table-auto border-separate border-spacing-1 w-full pr-4"><thead><tr><th>tileID</th><th>z</th><th>x</th><th>y</th><th>offset</th><th>length</th><th>runlength</th></tr></thead><tbody>'),Nt=C('<button type=button class="underline cursor-pointer">'),Bt=C("<tr class=hover:bg-purple><td></td><td class=app-text-light></td><td class=app-text-light></td><td class=app-text-light></td><td></td><td></td><td>"),Zt=C("<a class=underline target=_blank rel=noreferrer>"),Vt=C('<div class="flex-1 flex h-full w-full font-mono text-xs md:text-sm"><div class="flex flex-col h-full flex-1"></div><div class="flex flex-col">'),Gt=C('<div class="flex-none overflow-x-scroll"><table class="text-right table-auto border-separate border-spacing-2 p-4 w-full text-xs"><thead><tr class=app-text-light><th>Layout (bytes)</th><th>offset</th><th>length</th></tr></thead><tbody><tr><td class=app-text-light>Root Dir</td><td></td><td></td></tr><tr><td class=app-text-light>Metadata</td><td></td><td></td></tr><tr><td class=app-text-light>Leaf Dirs</td><td></td><td></td></tr><tr><td class=app-text-light>Tile Data</td><td></td><td>'),Xt=C('<div class="flex w-1/3 h-full flex-1 overflow-hidden"><div class="w-full flex flex-1 overflow-hidden">'),qt=C('<div class="flex text-xs overflow-x-scroll"><table class="table-auto border-separate border-spacing-2 w-1/2"><tbody><tr><td class="text-right app-text-light">Addressed tiles</td><td></td></tr><tr><td class="text-right app-text-light">Tile entries</td><td></td></tr><tr><td class="text-right app-text-light">Tile contents</td><td></td></tr><tr><td class="text-right app-text-light">Clustered</td><td></td></tr><tr><td class="text-right app-text-light">Internal compression</td><td></td></tr><tr><td class="text-right app-text-light">Tile compression</td><td></td></tr></tbody></table><table class="table-auto border-separate border-spacing-2 w-1/2"><tbody><tr><td class="text-right app-text-light">Tile type</td><td></td></tr><tr><td class="text-right app-text-light">Min zoom</td><td></td></tr><tr><td class="text-right app-text-light">Max zoom</td><td></td></tr><tr><td class="text-right app-text-light">Center zoom</td><td></td></tr><tr><td class="text-right app-text-light">Bounds</td><td> <!> <!> </td></tr><tr><td class="text-right app-text-light">Center</td><td> ');const X=Number.MAX_VALUE,lt=r=>r===E.Unknown?"unknown":r===E.None?"none":r===E.Gzip?"gzip":r===E.Brotli?"brotli":r===E.Zstd?"zstd":"out of spec";function Jt(r){let i;const p=new Ft;let n;return V(()=>{const o=[],g=[];if(r.entries){for(const c of r.entries)if(c.runLength===1){const[a,u,d]=I(c.tileId),s=p.bbox(u,d,a);o.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[s[0],s[1]],[s[2],s[1]],[s[2],s[3]],[s[0],s[3]],[s[0],s[1]]]]}})}else{const a=[];for(let u=c.tileId;u<c.tileId+c.runLength;u++){const[d,s,f]=I(u),t=p.bbox(s,f,d),h=(t[0]+t[2])/2,b=(t[1]+t[3])/2;a.push([h,b])}g.push({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:a}})}n.getSource("archive").setData({type:"FeatureCollection",features:o}),n.getSource("runs").setData({type:"FeatureCollection",features:g})}}),V(()=>{if(r.hoveredTile){const[o,g,c]=I(r.hoveredTile),a=p.bbox(g,c,o);n.getSource("hoveredTile").setData({type:"Polygon",coordinates:[[[a[0],a[1]],[a[2],a[1]],[a[2],a[3]],[a[0],a[3]],[a[0],a[1]]]]}),n.flyTo({center:[(a[0]+a[2])/2,(a[1]+a[3])/2],zoom:Math.max(o-4,0)})}}),Ot(()=>{var g;if(!i){console.error("Could not mount map element");return}j.getRTLTextPluginStatus()==="unavailable"&&j.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",!0);let o="white";(g=window.matchMedia)!=null&&g.call(window,"(prefers-color-scheme: dark)").matches&&(o="black"),n=new j.Map({container:i,attributionControl:!1,style:{version:8,glyphs:"https://protomaps.github.io/basemaps-assets/fonts/{fontstack}/{range}.pbf",sprite:`https://protomaps.github.io/basemaps-assets/sprites/v4/${o}`,sources:{basemap:{type:"vector",tiles:["https://api.protomaps.com/tiles/v4/{z}/{x}/{y}.mvt?key=1003762824b9687f"],attribution:"Â© <a href='https://openstreetmap.org/copyright'>OpenStreetMap</a>",maxzoom:15},archive:{type:"geojson",data:{type:"FeatureCollection",features:[]},buffer:16,tolerance:0},runs:{type:"geojson",data:{type:"FeatureCollection",features:[]},buffer:16,tolerance:0},hoveredTile:{type:"geojson",data:{type:"FeatureCollection",features:[]},buffer:16,tolerance:0}},layers:[...Pt("basemap",jt(o),{lang:"en"}),{id:"archive",source:"archive",type:"line",paint:{"line-color":"#3131DC","line-opacity":.8,"line-width":2}},{id:"runs",source:"runs",type:"line",paint:{"line-color":"#ffffff","line-opacity":.3}},{id:"hoveredTile",source:"hoveredTile",type:"fill",paint:{"fill-color":"white","fill-opacity":.3}}]}}),n.addControl(new j.AttributionControl({compact:!1}),"bottom-right"),n.on("style.load",()=>{n.setProjection({type:"globe"}),n.resize()})}),(()=>{var o=At(),g=o.firstChild,c=i;return typeof c=="function"?Ut(c,g):i=g,o})()}function it(r){const[i,p]=A(0),n=o=>o>=0&&o<r.entries.length;return(()=>{var o=Ht(),g=o.firstChild,c=g.firstChild,a=c.firstChild,u=a.nextSibling,d=u.nextSibling,s=d.nextSibling;s.nextSibling;var f=c.nextSibling,t=f.nextSibling,h=g.nextSibling,b=h.firstChild,T=b.firstChild,w=T.nextSibling;return e(c,i,u),e(c,()=>i()+999,s),e(c,()=>r.entries.length,null),e(g,x(M,{get when(){return r.isLeaf},get children(){var l=Rt();return l.$$click=()=>r.setOpenedLeaf(X),l}}),f),f.$$click=()=>{p(i()-1e3)},t.$$click=()=>{p(i()+1e3)},e(w,x(Et,{get each(){return r.entries.slice(i(),i()+1e3)},children:l=>(()=>{var v=Bt(),$=v.firstChild,L=$.nextSibling,m=L.nextSibling,S=m.nextSibling,y=S.nextSibling,k=y.nextSibling,D=k.nextSibling;return v.$$mousemove=()=>r.setHoveredTile(l.tileId),e($,()=>l.tileId),e(L,()=>I(l.tileId)[0]),e(m,()=>I(l.tileId)[1]),e(S,()=>I(l.tileId)[2]),e(y,x(M,{get when(){return l.runLength===0},get fallback(){return(()=>{var _=Zt();return e(_,()=>l.offset),G(()=>kt(_,"href",zt(r.stateUrl,I(l.tileId)))),_})()},get children(){var _=Nt();return _.$$click=()=>r.setOpenedLeaf(l.tileId),e(_,()=>l.offset),_}})),e(k,()=>l.length),e(D,x(M,{get when(){return l.runLength===0},get fallback(){return l.runLength},children:"0 (leaf)"})),v})()})),G(l=>{var v=!!n(i()-1e3),$=!n(i()-1e3),L=!n(i()-1e3),m=!!n(i()+1e3),S=!n(i()+1e3),y=!n(i()+1e3);return v!==l.e&&f.classList.toggle("underline",l.e=v),$!==l.t&&f.classList.toggle("app-text-light",l.t=$),L!==l.a&&(f.disabled=l.a=L),m!==l.o&&t.classList.toggle("underline",l.o=m),S!==l.i&&t.classList.toggle("app-text-light",l.i=S),y!==l.n&&(t.disabled=l.n=y),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),o})()}function Yt(r){const i=Dt(()=>{const d=r.genericTileset();if(d instanceof It)return d;throw alert("This isn't a PMTiles archive!"),"This isn't a PMTiles tileset"}),[p]=Z(i,async d=>await d.archive.getHeader()),[n]=Z(p,async d=>await i().archive.cache.getDirectory(i().archive.source,d.rootDirectoryOffset,d.rootDirectoryLength,d)),[o,g]=A(X),[c,a]=A(),[u]=Z(o,async d=>{if(d===X)return;const s=p(),f=n();if(!f||!s)return;const t=f.find(h=>h.tileId===d);if(t)return await i().archive.cache.getDirectory(i().archive.source,s.leafDirectoryOffset+t.offset,t.length,s)});return(()=>{var d=Vt(),s=d.firstChild,f=s.nextSibling;return e(s,x(M,{get when(){return p()},children:t=>(()=>{var h=Gt(),b=h.firstChild,T=b.firstChild,w=T.nextSibling,l=w.firstChild,v=l.firstChild,$=v.nextSibling,L=$.nextSibling,m=l.nextSibling,S=m.firstChild,y=S.nextSibling,k=y.nextSibling,D=m.nextSibling,_=D.firstChild,O=_.nextSibling,U=O.nextSibling,R=D.nextSibling,H=R.firstChild,F=H.nextSibling,N=F.nextSibling;return e($,()=>t().rootDirectoryOffset),e(L,()=>P(t().rootDirectoryLength)),e(y,()=>t().jsonMetadataOffset),e(k,()=>P(t().jsonMetadataLength)),e(O,()=>t().leafDirectoryOffset),e(U,()=>P(t().leafDirectoryLength||0)),e(F,()=>t().tileDataOffset),e(N,()=>P(t().tileDataLength||0)),h})()}),null),e(s,x(it,{get entries(){return n()||[]},get stateUrl(){return r.genericTileset().getStateUrl()},setHoveredTile:a,setOpenedLeaf:g}),null),e(d,x(M,{get when(){return u()},children:t=>(()=>{var h=Xt(),b=h.firstChild;return e(b,x(it,{get entries(){return t()},get stateUrl(){return r.genericTileset().getStateUrl()},setHoveredTile:a,setOpenedLeaf:g,isLeaf:!0})),h})()}),f),e(f,x(M,{get when(){return p()},children:t=>(()=>{var h=qt(),b=h.firstChild,T=b.firstChild,w=T.firstChild,l=w.firstChild,v=l.nextSibling,$=w.nextSibling,L=$.firstChild,m=L.nextSibling,S=$.nextSibling,y=S.firstChild,k=y.nextSibling,D=S.nextSibling,_=D.firstChild,O=_.nextSibling,U=D.nextSibling,R=U.firstChild,H=R.nextSibling,F=U.nextSibling,N=F.firstChild,nt=N.nextSibling,st=b.nextSibling,at=st.firstChild,q=at.firstChild,ot=q.firstChild,dt=ot.nextSibling,J=q.nextSibling,ct=J.firstChild,gt=ct.nextSibling,Y=J.nextSibling,ft=Y.firstChild,ht=ft.nextSibling,K=Y.nextSibling,ut=K.firstChild,xt=ut.nextSibling,Q=K.nextSibling,pt=Q.firstChild,z=pt.nextSibling,W=z.firstChild,tt=W.nextSibling,bt=tt.nextSibling,et=bt.nextSibling;et.nextSibling;var $t=Q.nextSibling,_t=$t.firstChild,B=_t.nextSibling,vt=B.firstChild;return e(v,()=>t().numAddressedTiles.toLocaleString()),e(m,()=>t().numTileEntries.toLocaleString()),e(k,()=>t().numTileContents.toLocaleString()),e(O,()=>t().clustered?"true":"false"),e(H,()=>lt(t().internalCompression)),e(nt,()=>lt(t().tileCompression)),e(dt,()=>Mt(t().tileType)),e(gt,()=>t().minZoom),e(ht,()=>t().maxZoom),e(xt,()=>t().centerZoom),e(z,()=>t().minLon,W),e(z,()=>t().minLat,tt),e(z,()=>t().maxLon,et),e(z,()=>t().maxLat,null),e(B,()=>t().centerLon,vt),e(B,()=>t().centerLat,null),h})()}),null),e(f,x(Jt,{get entries(){return u()||n()},get hoveredTile(){return c()}}),null),G(t=>{var h=u()!==void 0,b=u()===void 0,T=u()!==void 0,w=u()===void 0;return h!==t.e&&s.classList.toggle("w-1/3",t.e=h),b!==t.t&&s.classList.toggle("w-1/2",t.t=b),T!==t.a&&f.classList.toggle("w-1/3",t.a=T),w!==t.o&&f.classList.toggle("w-1/2",t.o=w),t},{e:void 0,t:void 0,a:void 0,o:void 0}),d})()}function Kt(){const r=yt(location.hash),[i,p]=A(r.url?Ct(decodeURIComponent(r.url)):void 0);return V(()=>{const n=i(),o=n==null?void 0:n.getStateUrl();location.hash=wt(location.hash,{url:o?encodeURIComponent(o):void 0})}),x(Tt,{tileset:i,setTileset:p,page:"archive",pmtilesOnly:!0,get children(){return x(M,{get when(){return i()},get fallback(){return x(Lt,{setTileset:p})},children:n=>x(Yt,{genericTileset:n})})}})}const rt=document.getElementById("root");rt&&mt(()=>x(Kt,{}),rt);St(["click","mousemove"]);
